# Repository Guidelines

## Project Overview
L1NE is a Zig monorepo structured like a Rust workspace. Key areas: `src/l1ne/` holds the orchestrator, `src/parsers/nix-zig/` the Nix parser, `src/parsers/ccl-zig/` the CCL parser, and `dumb-server/` a Rust demo. Artifacts generated by the Zig build land in `zig-out/`; treat it as throwaway state.

## Build System & Environment
Zig 0.15.x is enforced via `build.zig`; enter `nix develop` for the pinned toolchain. Core commands:
- `zig build` — compile the full toolchain and install binaries to `zig-out/bin`.
- `zig build run -- --help` — execute the CLI with arguments during iteration.
- `zig build nix-test`, `zig build nix-test-all`, `zig build bench-auto` — exercise and benchmark the parser.
- `zig build test` — run the aggregate suite wired through `src/l1ne/test.zig`.

## No Gambiarra Policy
Follow the zero-hack rule from CLAUDE.md:
- Deliver robust, simple, fast solutions—no duct tape or one-off hacks.
- If a task feels underspecified or impossible, stop, explain the gap, and request feedback instead of shipping partial code.
- Treat maintainers as domain experts: surface questions early and document context instead of guessing.

## TigerStyle Fundamentals
TigerStyle (see `docs/TIGER_STYLE.md`) governs every change:
- **Safety First:** prefer explicit control flow, cap loops, assert inputs/outputs (≥2 per function), use fixed-width integers, and keep allocation static.
- **Performance:** optimize from the outset—batch I/O, trim allocations, and pull hot loops into focused helpers.
- **Developer Experience:** name things precisely (`snake_case`, `UpperCamelCase`, `SCREAMING_SNAKE_CASE`), split complex conditionals, document *why*, and run `zig fmt` on touched files.

## Testing Expectations
New features demand co-located `*_test.zig` files with positive and negative assertions. Wire them into `src/l1ne/test.zig` so `zig build test` stays authoritative. During parser work, add fixtures under `src/parsers/nix-zig/test_data/` and validate via `zig build nix-test`. For narrow debugging, run `zig test path/to/module_test.zig`.

## Workflow, Commits & PRs
Commits use `.github/commit_template.txt`: `[scope] imperative summary`. Choose lowercase scopes (`[cli]`, `[sim]`), keep subject ≤72 chars, and leave AI co-author tags out. Bodies should capture motivation, list breaking changes, and reference issues (`Refs: #123`). Pull requests must explain the problem, enumerate changes, and attach proof of verification (`zig build`, `zig build test`, benchmarks, or logs). Include screenshots when touching observability or UX paths.

## Configuration & Scenarios
Use `config/` as canonical reference—copy locally before experimentation. Extend `scenarios/` when introducing new orchestration behaviour. Clean `zig-out/` or `.zig-cache/` before PRs to avoid noisy diffs.
